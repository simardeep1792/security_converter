{% extends "base.html" %}

{% block title %}
    <title>NATO Classification Conversion API - Documentation</title>
{% endblock title %}

{% block content %}
    <col class="col m-md-2 m-1">
        <h1>NATO Classification Conversion API</h1>
        <p class="lead">
            A GraphQL API middleware for converting security classifications between NATO nations
            using the NATO standard as a "Rosetta Stone".
        </p>

        <h2>Quick Links</h2>
        <ul>
            <li><a href="/graphql"><strong>GraphQL Endpoint</strong></a> - Production API endpoint</li>
            <li><a href="/playground"><strong>GraphQL Playground</strong></a> - Interactive API explorer with schema documentation</li>
            <li><a href="/dashboard"><strong>Analytics Dashboard</strong></a> - Real-time KPIs and performance metrics</li>
            <li><a href="/nation-analytics"><strong>Nation Analytics</strong></a> - Per-nation request analytics and metadata insights</li>
        </ul>

        <hr/>

        <h2>Table of Contents</h2>
        <ol>
            <li><a href="#overview">System Overview</a></li>
            <li><a href="#authentication">Authentication</a></li>
            <li><a href="#queries">Queries</a></li>
            <li><a href="#mutations">Mutations</a></li>
            <li><a href="#metadata-fields">Metadata Field Reference (DoD Compliant)</a></li>
            <li><a href="#examples">Complete Examples</a></li>
        </ol>

        <hr/>

        <h2 id="overview">1. System Overview</h2>
        <p>
            This API provides security classification conversion services for NATO member nations.
            It uses a two-step conversion process:
        </p>
        <pre><code>Source Nation Classification → NATO Standard → Target Nation Classification(s)</code></pre>

        <h3>Key Concepts</h3>
        <dl>
            <dt><strong>ConversionRequest</strong></dt>
            <dd>A request to convert a classified document from one nation's terminology to another's</dd>

            <dt><strong>ConversionResponse</strong></dt>
            <dd>The result containing NATO equivalent and target nation classifications</dd>

            <dt><strong>ClassificationSchema</strong></dt>
            <dd>Mapping between a nation's classification levels and NATO standards</dd>

            <dt><strong>Authority</strong></dt>
            <dd>A validated organization authorized to request conversions</dd>
        </dl>

        <hr/>

        <h2 id="authentication">2. Authentication</h2>

        <h3>Step 1: Sign In</h3>
        <p>Obtain a JWT token by signing in with your credentials:</p>
        <pre><code>mutation SignIn {
  signIn(input: {
    email: "user@nato.int"
    password: "your_password"
  }) {
    bearer
    email
    role
  }
}</code></pre>

        <h3>Step 2: Add Token to Headers</h3>
        <p>Include the bearer token in all subsequent requests:</p>
        <pre><code>{
  "Authorization": "Bearer YOUR_JWT_TOKEN_HERE"
}</code></pre>

        <hr/>

        <h2 id="queries">3. Queries</h2>

        <h3>3.1 Query Conversion Requests</h3>
        <h4>Get All Conversion Requests</h4>
        <pre><code>query {
  conversionRequests {
    id
    sourceNationCode
    sourceNationClassification
    targetNationCodes
    createdAt
    completedAt
    creator {
      name
      email
    }
  }
}</code></pre>

        <h4>Get Request by ID</h4>
        <pre><code>query {
  conversionRequestById(id: "uuid-here") {
    id
    sourceNationCode
    sourceNationClassification
    targetNationCodes
    dataObject {
      title
      description
    }
    metadata {
      domain
      tags
    }
  }
}</code></pre>

        <h4>Get Pending Requests</h4>
        <pre><code>query {
  conversionRequestsPending {
    id
    sourceNationCode
    createdAt
  }
}</code></pre>

        <h3>3.2 Query Conversion Responses</h3>
        <h4>Get All Responses</h4>
        <pre><code>query {
  conversionResponses {
    id
    natoEquivalent
    targetNationClassifications
    createdAt
    expiresAt
  }
}</code></pre>

        <h4>Get Response by Request ID</h4>
        <pre><code>query {
  conversionResponsesByRequestId(requestId: "uuid-here") {
    id
    natoEquivalent
    targetNationClassifications
    subjectData {
      title
    }
  }
}</code></pre>

        <h4>Get Active (Non-Expired) Responses</h4>
        <pre><code>query {
  conversionResponsesActive {
    id
    natoEquivalent
    expiresAt
  }
}</code></pre>

        <h3>3.3 Query Classification Schemas</h3>
        <h4>Get Schema by Nation Code</h4>
        <pre><code>query {
  classificationSchemasByNationCode(nationCode: "USA") {
    id
    nationCode
    toNatoUnclassified
    toNatoRestricted
    toNatoConfidential
    toNatoSecret
    toNatoTopSecret
    version
  }
}</code></pre>

        <h3>3.4 Query Nations</h3>
        <pre><code>query {
  nations {
    id
    nationCode
    nationName
  }
}</code></pre>

        <h3>3.5 Query Authorities</h3>
        <pre><code>query {
  authorities {
    id
    name
    email
    nation {
      nationCode
      nationName
    }
  }
}</code></pre>

        <hr/>

        <h2 id="mutations">4. Mutations</h2>

        <h3>4.1 Submit Conversion Request (Main Operation)</h3>
        <p>Submit a document for classification conversion. This automatically processes the conversion.</p>
        <pre><code>mutation SubmitConversion {
  submitConversionRequest(conversionData: {
    userId: "your-user-uuid"
    authorityId: "your-authority-uuid"
    dataObject: {
      title: "Intelligence Report #2024-001"
      description: "Strategic intelligence assessment"
    }
    metadata: {
      identifier: "urn:uuid:550e8400-e29b-41d4-a716-446655440000"
      authorizationReference: "OPORD 24-001"
      authorizationReferenceDate: "2024-01-15T00:00:00"
      originatorOrganizationId: "originator-authority-uuid"
      custodianOrganizationId: "custodian-authority-uuid"
      format: "application/pdf"
      formatSize: 2048576
      securityClassification: "SECRET"
      releasableToCountries: ["USA", "GBR", "FRA"]
      releasableToOrganizations: ["NATO"]
      disclosureCategory: "Category C"
      handlingRestrictions: ["CUI"]
      handlingAuthority: "32 CFR Part 2002"
      domain: "INTEL"
      tags: ["urgent", "classified", "strategic"]
    }
    sourceNationClassification: "SECRET"
    sourceNationCode: "USA"
    targetNationCodes: ["GBR", "FRA", "DEU"]
  }) {
    request {
      id
      createdAt
    }
    response {
      id
      natoEquivalent
      targetNationClassifications
    }
    success
    message
  }
}</code></pre>

        <h3>4.2 Create Request Without Processing</h3>
        <p>Create a conversion request for later/batch processing:</p>
        <pre><code>mutation CreateRequest {
  createConversionRequest(conversionData: {
    userId: "your-user-uuid"
    authorityId: "your-authority-uuid"
    dataObject: {
      title: "Operational Brief"
      description: "Mission planning document"
    }
    metadata: {
      identifier: "urn:uuid:660e8400-e29b-41d4-a716-446655440001"
      originatorOrganizationId: "originator-authority-uuid"
      custodianOrganizationId: "custodian-authority-uuid"
      format: "application/msword"
      securityClassification: "CONFIDENTIAL"
      releasableToCountries: ["GBR", "USA", "CAN"]
      domain: "OPERATIONS"
      tags: ["planning"]
    }
    sourceNationClassification: "CONFIDENTIAL"
    sourceNationCode: "GBR"
    targetNationCodes: ["USA", "CAN"]
  }) {
    id
    sourceNationCode
    createdAt
  }
}</code></pre>

        <h3>4.3 Process Existing Request (Admin Only)</h3>
        <pre><code>mutation ProcessRequest {
  processConversionRequest(requestId: "uuid-here") {
    id
    natoEquivalent
    targetNationClassifications
  }
}</code></pre>

        <h3>4.4 Mark Request as Completed (Admin Only)</h3>
        <pre><code>mutation MarkCompleted {
  markConversionRequestCompleted(requestId: "uuid-here") {
    id
    completedAt
  }
}</code></pre>

        <h3>4.5 Delete Request (Admin Only)</h3>
        <pre><code>mutation DeleteRequest {
  deleteConversionRequest(requestId: "uuid-here")
}</code></pre>

        <hr/>

        <h2 id="metadata-fields">4.6 Metadata Field Reference (DoD Compliant)</h2>
        <p>All conversion requests must include metadata compliant with <strong>DoD Metadata Guidance (January 2023)</strong>. The metadata structure includes 10 required baseline fields organized into Resource Description and Safeguarding categories.</p>

        <h3>Required Fields</h3>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Field</th>
                    <th>Type</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>identifier</code></td>
                    <td>String</td>
                    <td>Universal unique reference (GUID or URN format)</td>
                    <td>"urn:uuid:550e8400-e29b-41d4-a716-446655440000"</td>
                </tr>
                <tr>
                    <td><code>originatorOrganizationId</code></td>
                    <td>UUID</td>
                    <td>Authority ID of organization primarily responsible for generating the resource</td>
                    <td>"987e6543-e21b-12d3-a456-426614174000"</td>
                </tr>
                <tr>
                    <td><code>custodianOrganizationId</code></td>
                    <td>UUID</td>
                    <td>Authority ID of organization legally responsible for the resource</td>
                    <td>"987e6543-e21b-12d3-a456-426614174000"</td>
                </tr>
                <tr>
                    <td><code>format</code></td>
                    <td>String</td>
                    <td>File format or physical medium (MIME type preferred)</td>
                    <td>"application/pdf", "image/jpeg", "text/xml"</td>
                </tr>
                <tr>
                    <td><code>securityClassification</code></td>
                    <td>String</td>
                    <td>Highest classification level in the resource</td>
                    <td>"UNCLASSIFIED", "SECRET", "TOP SECRET"</td>
                </tr>
                <tr>
                    <td><code>domain</code></td>
                    <td>String</td>
                    <td>Mission domain or category (legacy field)</td>
                    <td>"INTEL", "OPERATIONS", "LOGISTICS"</td>
                </tr>
                <tr>
                    <td><code>tags</code></td>
                    <td>Array[String]</td>
                    <td>Keywords for categorization (legacy field)</td>
                    <td>["urgent", "strategic", "classified"]</td>
                </tr>
            </tbody>
        </table>

        <h3>Optional Fields</h3>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Field</th>
                    <th>Type</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>authorizationReference</code></td>
                    <td>String</td>
                    <td>Documented legal basis for mission activities (law, policy, order)</td>
                    <td>"OPORD 24-001", "EO 13526", "FRAGO 2024-027"</td>
                </tr>
                <tr>
                    <td><code>authorizationReferenceDate</code></td>
                    <td>DateTime</td>
                    <td>Date of authorization reference document (ISO 8601 format)</td>
                    <td>"2024-01-15T00:00:00"</td>
                </tr>
                <tr>
                    <td><code>formatSize</code></td>
                    <td>Integer</td>
                    <td>File size in bytes</td>
                    <td>2048576 (2 MB)</td>
                </tr>
                <tr>
                    <td><code>releasableToCountries</code></td>
                    <td>Array[String]</td>
                    <td>Country codes approved for disclosure (ISO 3166-1 alpha-3)</td>
                    <td>["USA", "GBR", "CAN", "AUS", "NZL"]</td>
                </tr>
                <tr>
                    <td><code>releasableToOrganizations</code></td>
                    <td>Array[String]</td>
                    <td>Organizations approved for disclosure</td>
                    <td>["NATO", "FVEY", "EU"]</td>
                </tr>
                <tr>
                    <td><code>releasableToCategories</code></td>
                    <td>Array[String]</td>
                    <td>Categories of people approved for disclosure</td>
                    <td>["contractors", "public", "cleared personnel"]</td>
                </tr>
                <tr>
                    <td><code>disclosureCategory</code></td>
                    <td>String</td>
                    <td>DoD disclosure category designation</td>
                    <td>"Category A", "Category B", "Category C"</td>
                </tr>
                <tr>
                    <td><code>handlingRestrictions</code></td>
                    <td>Array[String]</td>
                    <td>Non-classification limitations (CUI, PII, FOUO, etc.)</td>
                    <td>["CUI", "PII", "NOFORN", "FOUO"]</td>
                </tr>
                <tr>
                    <td><code>handlingAuthority</code></td>
                    <td>String</td>
                    <td>Policy or legislation authorizing handling restrictions</td>
                    <td>"32 CFR Part 2002", "Privacy Act of 1974"</td>
                </tr>
                <tr>
                    <td><code>noHandlingRestrictions</code></td>
                    <td>Boolean</td>
                    <td>Explicitly indicates no handling restrictions apply</td>
                    <td>true, false</td>
                </tr>
            </tbody>
        </table>

        <h3>Metadata Best Practices</h3>
        <ul>
            <li><strong>Use structured identifiers</strong> - URN format preferred: <code>urn:uuid:{guid}</code></li>
            <li><strong>Reference valid Authority IDs</strong> - Originator and Custodian must be existing Authority records</li>
            <li><strong>Use standard MIME types</strong> - For format field: application/pdf, image/jpeg, text/xml, etc.</li>
            <li><strong>Be specific with classifications</strong> - Use exact terms from your nation's ClassificationSchema</li>
            <li><strong>Specify releasability</strong> - At least one of: countries, organizations, or categories</li>
            <li><strong>Document restrictions clearly</strong> - Include handling authority for audit trail</li>
            <li><strong>Maintain timestamps</strong> - Use ISO 8601 format (YYYY-MM-DDTHH:MM:SS) in UTC</li>
        </ul>

        <h3>Minimal Valid Metadata Example</h3>
        <pre><code>{
  "identifier": "urn:uuid:550e8400-e29b-41d4-a716-446655440000",
  "originatorOrganizationId": "987e6543-e21b-12d3-a456-426614174000",
  "custodianOrganizationId": "987e6543-e21b-12d3-a456-426614174000",
  "format": "text/plain",
  "securityClassification": "UNCLASSIFIED",
  "domain": "GENERAL",
  "tags": ["test"]
}</code></pre>

        <h3>Complete Metadata Example</h3>
        <pre><code>{
  "identifier": "urn:uuid:770e8400-e29b-41d4-a716-446655440002",
  "authorizationReference": "FRAGO 2024-027",
  "authorizationReferenceDate": "2024-03-20T10:30:00",
  "originatorOrganizationId": "987e6543-e21b-12d3-a456-426614174000",
  "custodianOrganizationId": "987e6543-e21b-12d3-a456-426614174000",
  "format": "application/pdf",
  "formatSize": 5242880,
  "securityClassification": "SECRET",
  "releasableToCountries": ["USA", "GBR", "FRA"],
  "releasableToOrganizations": ["NATO"],
  "disclosureCategory": "Category B",
  "handlingRestrictions": ["CUI", "NOFORN"],
  "handlingAuthority": "EO 13526",
  "domain": "INTEL",
  "tags": ["regional", "threat-assessment", "strategic"]
}</code></pre>

        <hr/>

        <h2 id="examples">5. Complete Examples</h2>

        <h3>Example 1: Complete Conversion Workflow</h3>
        <p><strong>Scenario:</strong> US agency converting SECRET document for UK and France</p>

        <h4>Step 1: Sign In</h4>
        <pre><code>mutation {
  signIn(input: {
    email: "analyst@dia.gov"
    password: "SecurePassword123"
  }) {
    bearer
    role
  }
}</code></pre>

        <h4>Step 2: Submit Conversion (with variables)</h4>
        <p><strong>Query:</strong></p>
        <pre><code>mutation SubmitConversion($input: ConversionRequestInput!) {
  submitConversionRequest(conversionData: $input) {
    request {
      id
      sourceNationCode
      targetNationCodes
    }
    response {
      natoEquivalent
      targetNationClassifications
    }
    success
    message
  }
}</code></pre>

        <p><strong>Variables:</strong></p>
        <pre><code>{
  "input": {
    "userId": "123e4567-e89b-12d3-a456-426614174000",
    "authorityId": "987e6543-e21b-12d3-a456-426614174000",
    "dataObject": {
      "title": "Intelligence Assessment: Eastern Europe",
      "description": "Comprehensive intelligence report on regional threats"
    },
    "metadata": {
      "identifier": "urn:uuid:770e8400-e29b-41d4-a716-446655440002",
      "authorizationReference": "FRAGO 2024-027",
      "authorizationReferenceDate": "2024-03-20T10:30:00",
      "originatorOrganizationId": "987e6543-e21b-12d3-a456-426614174000",
      "custodianOrganizationId": "987e6543-e21b-12d3-a456-426614174000",
      "format": "application/pdf",
      "formatSize": 5242880,
      "securityClassification": "SECRET",
      "releasableToCountries": ["USA", "GBR", "FRA"],
      "releasableToOrganizations": ["NATO"],
      "disclosureCategory": "Category B",
      "handlingRestrictions": ["CUI", "NOFORN"],
      "handlingAuthority": "EO 13526",
      "domain": "INTEL",
      "tags": ["regional", "threat-assessment", "strategic"]
    },
    "sourceNationClassification": "SECRET",
    "sourceNationCode": "USA",
    "targetNationCodes": ["GBR", "FRA"]
  }
}</code></pre>

        <p><strong>Expected Response:</strong></p>
        <pre><code>{
  "data": {
    "submitConversionRequest": {
      "request": {
        "id": "abc123...",
        "sourceNationCode": "USA",
        "targetNationCodes": ["GBR", "FRA"]
      },
      "response": {
        "natoEquivalent": "NATO SECRET",
        "targetNationClassifications": {
          "GBR": "SECRET",
          "FRA": "SECRET DÉFENSE"
        }
      },
      "success": true,
      "message": "Conversion request submitted and processed successfully"
    }
  }
}</code></pre>

        <h3>Example 2: Query Request History</h3>
        <pre><code>query RequestHistory {
  conversionRequestsByCreatorId(
    creatorId: "123e4567-e89b-12d3-a456-426614174000"
  ) {
    id
    sourceNationCode
    sourceNationClassification
    targetNationCodes
    createdAt
    isCompleted
    dataObject {
      title
    }
  }
}</code></pre>

        <h3>Example 3: Check Classification Schema</h3>
        <p>Before submitting, verify the correct classification terms for your nation:</p>
        <pre><code>query {
  classificationSchemasByNationCode(nationCode: "POL") {
    nationCode
    toNatoUnclassified
    toNatoRestricted
    toNatoConfidential
    toNatoSecret
    toNatoTopSecret
  }
}</code></pre>

        <p><strong>Response shows Poland's terminology:</strong></p>
        <pre><code>{
  "data": {
    "classificationSchemasByNationCode": [{
      "nationCode": "POL",
      "toNatoUnclassified": "Jawne",
      "toNatoRestricted": "Zastrzeżone",
      "toNatoConfidential": "Poufne",
      "toNatoSecret": "Tajne",
      "toNatoTopSecret": "Ściśle Tajne"
    }]
  }
}</code></pre>

        <hr/>

        <h2>Classification Levels Reference</h2>
        <h3>NATO Standard Levels</h3>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Level</th>
                    <th>NATO Term</th>
                    <th>Description</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>NATO UNCLASSIFIED</td>
                    <td>Information that does not require protection</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>NATO RESTRICTED</td>
                    <td>Lowest level of classified information</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>NATO CONFIDENTIAL</td>
                    <td>Unauthorized disclosure could be damaging</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>NATO SECRET</td>
                    <td>Unauthorized disclosure could be seriously damaging</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>COSMIC TOP SECRET</td>
                    <td>Highest level; exceptionally grave damage if disclosed</td>
                </tr>
            </tbody>
        </table>

        <h3>Example National Equivalents</h3>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Nation</th>
                    <th>Unclassified</th>
                    <th>Restricted</th>
                    <th>Confidential</th>
                    <th>Secret</th>
                    <th>Top Secret</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>🇺🇸 USA</td>
                    <td>UNCLASSIFIED</td>
                    <td>RESTRICTED</td>
                    <td>CONFIDENTIAL</td>
                    <td>SECRET</td>
                    <td>TOP SECRET</td>
                </tr>
                <tr>
                    <td>🇬🇧 GBR</td>
                    <td>OFFICIAL</td>
                    <td>OFFICIAL-SENSITIVE</td>
                    <td>SECRET</td>
                    <td>SECRET</td>
                    <td>TOP SECRET</td>
                </tr>
                <tr>
                    <td>🇫🇷 FRA</td>
                    <td>Non Protégé</td>
                    <td>Diffusion Restreinte</td>
                    <td>Confidentiel Défense</td>
                    <td>Secret Défense</td>
                    <td>Très Secret Défense</td>
                </tr>
                <tr>
                    <td>🇵🇱 POL</td>
                    <td>Jawne</td>
                    <td>Zastrzeżone</td>
                    <td>Poufne</td>
                    <td>Tajne</td>
                    <td>Ściśle Tajne</td>
                </tr>
            </tbody>
        </table>

        <hr/>

        <h2>API Best Practices</h2>
        <ul>
            <li><strong>Always authenticate</strong> - Include your JWT token in the Authorization header</li>
            <li><strong>Use correct terminology</strong> - Check the ClassificationSchema for your nation's specific terms</li>
            <li><strong>Provide complete metadata</strong> - Include all required DoD-compliant metadata fields (see <a href="#metadata-fields">Metadata Field Reference</a>)</li>
            <li><strong>Use structured identifiers</strong> - Use URN format for metadata identifiers: <code>urn:uuid:{guid}</code></li>
            <li><strong>Reference valid authorities</strong> - Ensure originator and custodian organization IDs exist in the system</li>
            <li><strong>Specify releasability</strong> - Always include at least one releasability field (countries, organizations, or categories)</li>
            <li><strong>Check schema expiration</strong> - Classification schemas may expire and be updated</li>
            <li><strong>Handle errors gracefully</strong> - The API returns descriptive error messages</li>
            <li><strong>Batch operations</strong> - Use createConversionRequest for multiple requests, then process in batch</li>
        </ul>

        <hr/>

        <h2>Error Handling</h2>
        <p>Common errors and solutions:</p>
        <dl>
            <dt>"User not authenticated"</dt>
            <dd>Solution: Ensure you've included the JWT token in the Authorization header</dd>

            <dt>"Unknown classification 'X' for nation Y"</dt>
            <dd>Solution: Check the classification schema for the correct terminology for that nation</dd>

            <dt>"Classification schema for nation X has expired"</dt>
            <dd>Solution: Contact an administrator to update the classification schema</dd>

            <dt>"No classification schema found for nation X"</dt>
            <dd>Solution: The nation's schema needs to be created by an administrator</dd>
        </dl>

        <hr/>

        <h2>Support & Resources</h2>
        <ul>
            <li><strong>GraphQL Playground:</strong> <a href="/playground">/playground</a> - Interactive API explorer with complete schema documentation</li>
            <li><strong>GraphQL Endpoint:</strong> <a href="/graphql">/graphql</a> - Production API endpoint</li>
            <li><strong>Schema Introspection:</strong> Available in the Playground "Docs" panel</li>
        </ul>

        <p class="text-muted mt-5">
            <small>
                NATO Classification Conversion API v0.2.1<br/>
                For official use by authorized NATO personnel only.
            </small>
        </p>

    </col>
{% endblock content %}
